#!/bin/bash

link=$(awk '/https*:\/\/|gopher:\/\//' < /dev/stdin | sed 's/.*http/http/g;s/.*gopher/gopher/g' | tr -d '<[]>' | awk '{print $1}' | sort | dmenu -i -p "Select a url:")

IFS=$'\n'

hand=$(printf "mpv
popupmpv
youtube-dl --add-metadata -ic
youtube-dl --add-metadata -xic
vimb --no-maximize
xclip
webimg
st -e curl" | dmenu -i -p "Select a handler:")

pkill mpvlisten
hmpv pause /tmp/mpv-socket
hmpv pause /tmp/mpv-socket2
sh -c "$hand $link"
mpvlisten /tmp/mpv-socket2 /tmp/mpv-socket &
