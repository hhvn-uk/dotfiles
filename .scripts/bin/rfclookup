#!/bin/sh
#
# rfclookup.sh
# Created by Hayden Hamilton
#
# hayden@haydenvh.com
# Copyright (c) 2020 Hayden Hamilton
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.
#
# This work is free. You can redistribute it and/or modify it under the      
# terms of the Do What The Fuck You Want To Public License, Version 2,       
# as published by Sam Hocevar. See http://www.wtfpl.net/ for more details.   

# usage: rfclookup.sh -s <search query>
#	 rfclookup.sh -n <number>

[ "$1" = "-s" ] && {
	resp=$(curl https://www.ietf.org/download/rfc-index.txt | tr '\n' '\t' | sed 's/\t\t/\n/g' | tr '\t' ' ' | tr -s ' ' | grep '^[0-9][0-9][0-9][0-9] ' | grep -iE "$2")
	[ "$(echo "$resp" | wc -l)" = 0 ] && echo "error: no such docu" > /dev/stderr|| \
	[ "$(echo "$resp" | wc -l)" = 1 ] && curl https://ietf.org/rfc/rfc${resp%% *}.txt || {
		echo "$resp" > /dev/stderr
		printf "Please choose an rfc (number): " > /dev/stderr
		read num < /dev/tty
		curl https://ietf.org/rfc/rfc$num.txt
	}
} || {
	curl https://ietf.org/rfc/rfc$2.txt
}
