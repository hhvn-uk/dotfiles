#!/bin/sh

link=$(grep -Eo '[A-Za-z][A-Za-z]*://[^ >),]*' < /dev/stdin 2>/dev/null | awk '{print $1}' | dmenu -i)
[ "$link" = "" ] && exit 1

tor=$(printf "no\nyes" | dmenu -i -p "Tor?")

hand=$(printf "mpvms video
mpvms
mpv --pause
popupmpv
youtube-dl --add-metadata -ic
youtube-dl --add-metadata -xic
$(xprop -id $(cat /tmp/tabbed.xid) >/dev/null && echo "surf -e $(cat /tmp/tabbed.xid)" || echo ">/tmp/tabbed.xid tabbed -cr2 surf -e ''")
toxclip
netimg
netvid
popupcurl
popupcgo" | dmenu -i)

[ "$tor" = "yes" ] && sh -c "torsocks $hand $link" || sh -c "$hand $link"
