#!/bin/bash
#
# dwmblocks/bat
# Created by Hayden Hamilton
#
# haydenvh.com
# Copyright (c) 2019 Hayden Hamilton.
total=0
charge=0
for b in $(find /sys/class/power_supply -name "BAT*")
do
	total=$(($total+100))
	read cap < $b/capacity
	charge=$(($charge+$cap))
	grep -i 'charg' < $b/status >/dev/null && charging='y'
	grep -i 'discharg' < $b/status >/dev/null && discharging='y'
done
num=$(echo "scale=2; ($charge/$total)*21" | bc | sed 's~\..*$~~')
colour="#aa6600"
[ "$charging" = "y" ] && colour="#00aa00" 
[ $num -ge 19 ] && colour="#00aa00"
[ "$discharging" = "y" ] && colour="#aa0000"
echo "^r0,5,2,4^^r2,2,22,10^^c#000000^^r3,3,20,8^^c$colour^^r$((23-$num)),3,$num,8^^d^^f24^" > /tmp/bat
read output < /tmp/bat
printf "[B $output]"
echo
echo
echo \#C625C8
